<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Site with Argument Trees</title>
    <style>
        /* Main News Site Styles */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }

        .news-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .story-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .story-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .story-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .story-summary {
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .view-analysis {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        /* Argument Tree Modal Styles */
        .arg-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }

        .arg-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .arg-container {
            background: white;
            border-radius: 15px;
            max-width: 95vw;
            max-height: 95vh;
            overflow: auto;
            position: relative;
        }

        .arg-header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .arg-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .arg-close:hover {
            background: rgba(255,255,255,0.2);
        }

        .arg-content {
            padding: 40px;
            min-width: 900px;
        }

        /* True Tree Structure */
        .tree-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 700px;
            padding: 40px 20px;
        }

        .central-question {
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
            color: white;
            padding: 25px 40px;
            border-radius: 25px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 8px 25px rgba(238, 90, 111, 0.3);
            position: relative;
            z-index: 10;
            max-width: 600px;
            margin-bottom: 120px;
        }

        .tree-branches {
            position: relative;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 100px;
            min-height: 400px;
        }

        .branch-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .branch-label {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 40px;
            padding: 10px 25px;
            border-radius: 20px;
            color: white;
            text-align: center;
            z-index: 5;
            position: relative;
        }

        .reasons-label {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
        }

        .objections-label {
            background: linear-gradient(135deg, #fa709a, #fee140);
        }

        .nodes-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            align-items: center;
            position: relative;
        }

        .tree-node {
            background: white;
            border-radius: 15px;
            padding: 20px;
            max-width: 300px;
            min-width: 250px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            border-top: 4px solid;
            position: relative;
            transition: all 0.3s ease;
            z-index: 5;
        }

        .tree-node:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .reason-node {
            border-top-color: #4facfe;
        }

        .objection-node {
            border-top-color: #fa709a;
        }

        .node-description {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 15px;
            color: #333;
        }

        .sources {
            margin-top: 12px;
        }

        .source {
            display: flex;
            align-items: center;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
            margin: 6px 0;
            font-size: 12px;
        }

        .source img {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 8px;
            object-fit: cover;
        }

        .source-title {
            font-weight: 600;
            color: #2c3e50;
            text-decoration: none;
        }

        .source-title:hover {
            color: #3498db;
        }

        .expand-button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 12px;
            display: none;
        }

        .expand-button.has-children {
            display: inline-block;
        }

        .sub-nodes {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed #ddd;
            display: none;
        }

        .sub-nodes.expanded {
            display: block;
        }

        .sub-node {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0;
            border-left: 3px solid;
            font-size: 13px;
        }

        .sub-reason {
            border-left-color: #74b9ff;
        }

        .sub-objection {
            border-left-color: #fd79a8;
        }

        /* SVG Connection Lines */
        .connection-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .connection-line {
            stroke: #3498db;
            stroke-width: 2;
            fill: none;
            opacity: 0.7;
        }

        .node-connector {
            stroke: #7f8c8d;
            stroke-width: 1.5;
            fill: none;
            opacity: 0.6;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .arg-content {
                padding: 20px;
                min-width: unset;
            }
            
            .tree-branches {
                flex-direction: column;
                gap: 40px;
                align-items: center;
            }
            
            .central-question {
                font-size: 16px;
                padding: 20px 30px;
                margin-bottom: 60px;
            }
            
            .connection-svg {
                display: none;
            }
            
            .stories-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 1024px) {
            .tree-branches {
                gap: 60px;
            }
            
            .tree-node {
                max-width: 250px;
                min-width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="news-container">
        <div class="header">
            <h1>Ground News Style - Argument Analysis</h1>
            <p>Click on any story to see the argument analysis with tree structure</p>
        </div>

        <div class="stories-grid">
            <div class="story-card" onclick="showArgumentTree('ubi-story')">
                <div class="story-title">Universal Basic Income Debate Heats Up</div>
                <div class="story-summary">
                    Governments worldwide are reconsidering UBI policies as economic pressures mount. 
                    Supporters argue it could reduce poverty, while critics worry about work incentives.
                </div>
                <button class="view-analysis">View Analysis</button>
            </div>

            <div class="story-card" onclick="showArgumentTree('climate-story')">
                <div class="story-title">Climate Change Policy Divides Congress</div>
                <div class="story-summary">
                    New environmental legislation faces opposition from multiple sectors. 
                    The debate centers on economic costs versus environmental benefits.
                </div>
                <button class="view-analysis">View Analysis</button>
            </div>

            <div class="story-card" onclick="showArgumentTree('healthcare-story')">
                <div class="story-title">Healthcare Reform Proposals Under Review</div>
                <div class="story-summary">
                    Various healthcare models are being evaluated by policymakers. 
                    The discussion includes public vs private options and cost implications.
                </div>
                <button class="view-analysis">View Analysis</button>
            </div>
        </div>
    </div>

    <!-- Argument Tree Modal -->
    <div class="arg-modal" id="argModal">
        <div class="arg-container">
            <div class="arg-header">
                <h2 id="argTitle">Argument Analysis</h2>
                <button class="arg-close" onclick="closeArgumentTree()">×</button>
            </div>
            <div class="arg-content" id="argContent">
                <div style="text-align: center; padding: 40px; color: #666;">
                    Loading argument analysis...
                </div>
            </div>
        </div>
    </div>

    <script>
        // Facebook-style Engineering: Robust Argument Tree Implementation
        class ArgumentTree {
            constructor() {
                this.currentData = null;
                this.svgNamespace = 'http://www.w3.org/2000/svg';
            }

            async loadData(storyId) {
                // Simulate loading - in production this would fetch from API
                return this.getSampleData(storyId);
            }

            getSampleData(storyId) {
                const stories = {
                    'ubi-story': {
                        title: "Universal Basic Income Debate",
                        centralQuestion: "Should governments implement universal basic income?",
                        reasons: [
                            {
                                description: "UBI can reduce poverty by providing a stable income floor for all citizens.",
                                sources: [
                                    { title: "UBI and Poverty Alleviation Study", link: "https://example.com/ubi-poverty" }
                                ]
                            },
                            {
                                description: "It may encourage entrepreneurship by reducing the financial risk of starting a business.",
                                sources: [
                                    { title: "UBI and Startup Risk-Taking", link: "https://example.com/ubi-entrepreneurship" }
                                ]
                            },
                            {
                                description: "UBI could simplify welfare systems by replacing multiple targeted programs.",
                                sources: [
                                    { title: "Welfare System Simplification", link: "https://example.com/welfare-simple" }
                                ]
                            }
                        ],
                        objections: [
                            {
                                description: "UBI could disincentivize work, leading to reduced productivity and economic output.",
                                sources: [
                                    { title: "UBI and Labor Supply Analysis", link: "https://example.com/ubi-labor" }
                                ]
                            },
                            {
                                description: "The fiscal cost may be unsustainable without significant tax increases or cuts to other programs.",
                                sources: [
                                    { title: "Fiscal Impact of UBI", link: "https://example.com/ubi-cost" }
                                ]
                            }
                        ]
                    },
                    'climate-story': {
                        title: "Climate Change Policy Debate",
                        centralQuestion: "Should Congress pass aggressive climate legislation?",
                        reasons: [
                            {
                                description: "Urgent action is needed to prevent catastrophic climate change effects.",
                                sources: [
                                    { title: "IPCC Climate Report", link: "https://example.com/ipcc-report" }
                                ]
                            },
                            {
                                description: "Green energy investments could create millions of new jobs.",
                                sources: [
                                    { title: "Green Jobs Economic Analysis", link: "https://example.com/green-jobs" }
                                ]
                            }
                        ],
                        objections: [
                            {
                                description: "Rapid transition could harm traditional energy workers and communities.",
                                sources: [
                                    { title: "Energy Transition Impact Study", link: "https://example.com/energy-transition" }
                                ]
                            },
                            {
                                description: "High costs could burden taxpayers and reduce economic competitiveness.",
                                sources: [
                                    { title: "Climate Policy Cost Analysis", link: "https://example.com/climate-costs" }
                                ]
                            },
                            {
                                description: "Technology may not be ready for large-scale renewable energy deployment.",
                                sources: [
                                    { title: "Renewable Energy Technology Assessment", link: "https://example.com/renewable-tech" }
                                ]
                            }
                        ]
                    },
                    'healthcare-story': {
                        title: "Healthcare Reform Debate",
                        centralQuestion: "Should the US adopt a single-payer healthcare system?",
                        reasons: [
                            {
                                description: "Single-payer could reduce administrative costs and improve efficiency.",
                                sources: [
                                    { title: "Healthcare Administrative Costs", link: "https://example.com/healthcare-admin" }
                                ]
                            }
                        ],
                        objections: [
                            {
                                description: "Transition costs could be enormous and disruptive to current coverage.",
                                sources: [
                                    { title: "Healthcare Transition Analysis", link: "https://example.com/healthcare-transition" }
                                ]
                            },
                            {
                                description: "Government control might reduce innovation and choice in healthcare.",
                                sources: [
                                    { title: "Healthcare Innovation Study", link: "https://example.com/healthcare-innovation" }
                                ]
                            },
                            {
                                description: "Private insurance employees could lose jobs in the transition.",
                                sources: [
                                    { title: "Insurance Industry Employment", link: "https://example.com/insurance-jobs" }
                                ]
                            },
                            {
                                description: "Wait times for procedures might increase under government management.",
                                sources: [
                                    { title: "Healthcare Wait Times International", link: "https://example.com/wait-times" }
                                ]
                            }
                        ]
                    }
                };
                
                return stories[storyId] || stories['ubi-story'];
            }

            render(data) {
                if (!data || !data.centralQuestion) {
                    return '<div style="text-align: center; padding: 40px; color: #e74c3c;">Error loading argument data</div>';
                }

                const reasonsCount = data.reasons?.length || 0;
                const objectionsCount = data.objections?.length || 0;

                return `
                    <div class="tree-container">
                        <div class="central-question">${data.centralQuestion}</div>
                        
                        <div class="tree-branches">
                            ${reasonsCount > 0 ? `
                                <div class="branch-section" data-branch="reasons">
                                    <div class="branch-label reasons-label">Supporting Reasons</div>
                                    <div class="nodes-container">
                                        ${this.renderNodes(data.reasons, 'reason')}
                                    </div>
                                </div>
                            ` : ''}
                            
                            ${objectionsCount > 0 ? `
                                <div class="branch-section" data-branch="objections">
                                    <div class="branch-label objections-label">Objections</div>
                                    <div class="nodes-container">
                                        ${this.renderNodes(data.objections, 'objection')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                        
                        <svg class="connection-svg" id="connectionSvg">
                            <!-- Lines will be drawn here by JavaScript -->
                        </svg>
                    </div>
                `;
            }

            renderNodes(nodes, type) {
                if (!nodes || nodes.length === 0) return '';
                
                return nodes.map((node, index) => `
                    <div class="tree-node ${type}-node" data-node-type="${type}" data-node-index="${index}">
                        <div class="node-description">${node.description}</div>
                        ${this.renderSources(node.sources || [])}
                        <button class="expand-button ${this.hasChildren(node) ? 'has-children' : ''}" 
                                onclick="toggleSubNodes(this)">
                            ${this.hasChildren(node) ? 'Show Details' : ''}
                        </button>
                        <div class="sub-nodes">
                            ${this.renderSubNodes(node.underlyingReasons || [], 'reason')}
                            ${this.renderSubNodes(node.objections || [], 'objection')}
                        </div>
                    </div>
                `).join('');
            }

            renderSubNodes(nodes, type) {
                if (!nodes || nodes.length === 0) return '';
                
                return nodes.map(node => `
                    <div class="sub-node sub-${type}">
                        <div class="node-description">${node.description}</div>
                        ${this.renderSources(node.sources || [])}
                    </div>
                `).join('');
            }

            renderSources(sources) {
                if (!sources || sources.length === 0) return '';
                
                return `
                    <div class="sources">
                        ${sources.map(source => `
                            <div class="source">
                                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiByeD0iNCIgZmlsbD0iIzNBODBGRiIvPgo8cGF0aCBkPSJNNSA4SDE1VjlINVY4Wk01IDExSDE1VjEySDVWMTFaTTUgMTRIMTJWMTVINVYxNFoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo=" alt="Source">
                                <a href="${source.link}" target="_blank" class="source-title">${source.title}</a>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            hasChildren(node) {
                return (node.underlyingReasons && node.underlyingReasons.length > 0) ||
                       (node.objections && node.objections.length > 0);
            }

            // Facebook-style: Robust connection line drawing
            drawConnectionLines() {
                const svg = document.getElementById('connectionSvg');
                if (!svg) return;

                // Clear existing lines
                svg.innerHTML = '';

                const container = document.querySelector('.tree-container');
                const centralQuestion = document.querySelector('.central-question');
                const branchSections = document.querySelectorAll('.branch-section');

                if (!container || !centralQuestion || branchSections.length === 0) return;

                const containerRect = container.getBoundingClientRect();
                const questionRect = centralQuestion.getBoundingClientRect();

                // Calculate central question position relative to container
                const questionCenterX = questionRect.left + questionRect.width / 2 - containerRect.left;
                const questionBottomY = questionRect.bottom - containerRect.top;

                // Draw main trunk line down from central question
                const trunkLength = 60;
                this.createLine(svg, questionCenterX, questionBottomY, questionCenterX, questionBottomY + trunkLength, 'connection-line');

                // Draw horizontal connector between branches
                const branchY = questionBottomY + trunkLength;
                let leftmostX = questionCenterX;
                let rightmostX = questionCenterX;

                branchSections.forEach(section => {
                    const sectionRect = section.getBoundingClientRect();
                    const sectionCenterX = sectionRect.left + sectionRect.width / 2 - containerRect.left;
                    
                    leftmostX = Math.min(leftmostX, sectionCenterX);
                    rightmostX = Math.max(rightmostX, sectionCenterX);
                });

                // Draw horizontal line connecting branches
                if (branchSections.length > 1) {
                    this.createLine(svg, leftmostX, branchY, rightmostX, branchY, 'connection-line');
                }

                // Draw vertical connectors to each branch
                branchSections.forEach(section => {
                    const sectionRect = section.getBoundingClientRect();
                    const sectionCenterX = sectionRect.left + sectionRect.width / 2 - containerRect.left;
                    const label = section.querySelector('.branch-label');
                    
                    if (label) {
                        const labelRect = label.getBoundingClientRect();
                        const labelTopY = labelRect.top - containerRect.top;
                        
                        // Vertical line from horizontal connector to branch label
                        this.createLine(svg, sectionCenterX, branchY, sectionCenterX, labelTopY - 20, 'connection-line');
                    }

                    // Draw lines to individual nodes
                    const nodes = section.querySelectorAll('.tree-node');
                    nodes.forEach(node => {
                        const nodeRect = node.getBoundingClientRect();
                        const nodeCenterX = nodeRect.left + nodeRect.width / 2 - containerRect.left;
                        const nodeTopY = nodeRect.top - containerRect.top;
                        
                        // Line from branch center to node
                        this.createLine(svg, sectionCenterX, branchY + 40, nodeCenterX, nodeTopY, 'node-connector');
                    });
                });
            }

            createLine(svg, x1, y1, x2, y2, className) {
                const line = document.createElementNS(this.svgNamespace, 'line');
                line.setAttribute('x1', x1);
                line.setAttribute('y1', y1);
                line.setAttribute('x2', x2);
                line.setAttribute('y2', y2);
                line.setAttribute('class', className);
                svg.appendChild(line);
            }
        }

        // Global instance
        const argumentTree = new ArgumentTree();

        // Main functions
        async function showArgumentTree(storyId) {
            const modal = document.getElementById('argModal');
            const title = document.getElementById('argTitle');
            const content = document.getElementById('argContent');
            
            modal.classList.add('active');
            content.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">Loading argument analysis...</div>';
            
            const data = await argumentTree.loadData(storyId);
            if (data) {
                title.textContent = data.title;
                content.innerHTML = argumentTree.render(data);
                argumentTree.currentData = data;
                
                // Draw connection lines after DOM is ready
                setTimeout(() => {
                    argumentTree.drawConnectionLines();
                }, 100);
            } else {
                content.innerHTML = '<div style="text-align: center; padding: 40px; color: #e74c3c;">Error loading argument data</div>';
            }
        }

        function closeArgumentTree() {
            document.getElementById('argModal').classList.remove('active');
        }

        function toggleSubNodes(button) {
            const subNodes = button.nextElementSibling;
            const isExpanded = subNodes.classList.contains('expanded');
            
            if (isExpanded) {
                subNodes.classList.remove('expanded');
                button.textContent = button.textContent.replace('Hide', 'Show');
            } else {
                subNodes.classList.add('expanded');
                button.textContent = button.textContent.replace('Show', 'Hide');
            }
        }

        // Close modal when clicking outside
        document.getElementById('argModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeArgumentTree();
            }
        });

        // Redraw lines on window resize
        window.addEventListener('resize', () => {
            if (argumentTree.currentData) {
                setTimeout(() => {
                    argumentTree.drawConnectionLines();
                }, 100);
            }
        });
    </script>
</body>
</html>